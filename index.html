<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa Armónico Avanzado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #0f172a; color: white; }
    .line { stroke: #94a3b8; stroke-width: 1.2; opacity: 0.5; marker-end: url(#arrow); }
    .focus circle { filter: drop-shadow(0 0 10px #22d3ee); }
    .active circle { fill: #22d3ee !important; }
  </style>
</head>
<body>
  <div class="text-center py-6">
    <h1 class="text-4xl font-bold mb-2">Mapa Armónico Avanzado</h1>
    <p class="text-lg text-slate-300">Explora rutas de progresión armónica. Haz clic en un acorde para ver sus caminos posibles.</p>
  </div>
  <div class="flex justify-center">
    <svg id="network" viewBox="0 0 800 800" width="800" height="800"></svg>
  </div>
  <div class="text-center mt-4">
    <button onclick="reproducirProgresion()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">Reproducir Progresión</button>
    <button onclick="limpiarProgresion()" class="ml-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">Limpiar</button>
    <div id="progresion" class="mt-2 text-slate-300"></div>
  </div>  <script>
    const svg = document.getElementById("network");
    const center = 400;
    const outerRadius = 300;
    const innerRadius = 200;
    const outerChords = ["Am", "Em", "Bm", "F#m", "C#m", "G#m", "Ebm", "Bbm", "Fm", "Cm", "Gm", "Dm"];
    const innerChords = ["C", "G", "D", "A", "E", "B", "F#", "Db", "Ab", "Eb", "Bb", "F"];
    const relaciones = {
      "C": ["Am", "F", "G", "G7"], "G": ["Em", "C", "D"], "D": ["Bm", "G", "A"],
      "A": ["F#m", "D", "E"], "E": ["C#m", "A", "B"], "B": ["G#m", "E", "F#"],
      "F#": ["D#m", "B", "Db"], "Db": ["Bbm", "F#", "Ab"], "Ab": ["Fm", "Db", "Eb"],
      "Eb": ["Cm", "Ab", "Bb"], "Bb": ["Gm", "Eb", "F"], "F": ["Dm", "Bb", "C"]
    };

    const notasFrecuencia = {
      'C': 261.63, 'C#': 277.18, 'Db': 277.18, 'D': 293.66, 'Eb': 311.13, 'E': 329.63,
      'F': 349.23, 'F#': 369.99, 'G': 392.00, 'Ab': 415.30, 'A': 440.00, 'Bb': 466.16, 'B': 493.88,
      'Cm': 261.63, 'Dm': 293.66, 'Em': 329.63, 'Fm': 349.23, 'Gm': 392.00, 'Am': 440.00, 'Bm': 493.88,
      'F#m': 369.99, 'C#m': 277.18, 'G#m': 415.30, 'Ebm': 311.13, 'Bbm': 466.16, 'D#m': 311.13
    };

    const progresion = [];
    const posiciones = {};

    function crearRed() {
      const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
      marker.setAttribute("id", "arrow");
      marker.setAttribute("viewBox", "0 0 10 10");
      marker.setAttribute("refX", "5");
      marker.setAttribute("refY", "5");
      marker.setAttribute("markerWidth", "5");
      marker.setAttribute("markerHeight", "5");
      marker.setAttribute("orient", "auto-start-reverse");
      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", "M 0 0 L 10 5 L 0 10 z");
      path.setAttribute("fill", "#94a3b8");
      marker.appendChild(path);
      const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
      defs.appendChild(marker);
      svg.appendChild(defs);

      [...outerChords, ...innerChords].forEach((chord, i) => {
        const r = outerChords.includes(chord) ? outerRadius : innerRadius;
        const index = outerChords.includes(chord) ? outerChords.indexOf(chord) : innerChords.indexOf(chord);
        const angle = ((2 * Math.PI) / 12) * index - Math.PI / 2;
        const x = center + r * Math.cos(angle);
        const y = center + r * Math.sin(angle);
        posiciones[chord] = { x, y };

        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
        g.setAttribute("class", "chord-group");
        g.setAttribute("transform", `translate(${x},${y})`);
        g.innerHTML = `
          <circle r="20" fill="#1e293b" stroke="white" stroke-width="2" />
          <text x="0" y="5" text-anchor="middle" fill="white" font-size="16" font-family="sans-serif">${chord}</text>
        `;
        g.style.cursor = "pointer";
        g.onclick = () => seleccionarAcorde(chord);
        svg.appendChild(g);
      });

      Object.entries(relaciones).forEach(([origen, destinos]) => {
        destinos.forEach(dest => {
          const l = document.createElementNS("http://www.w3.org/2000/svg", "line");
          l.setAttribute("x1", posiciones[origen].x);
          l.setAttribute("y1", posiciones[origen].y);
          l.setAttribute("x2", posiciones[dest]?.x || 0);
          l.setAttribute("y2", posiciones[dest]?.y || 0);
          l.setAttribute("class", "line");
          svg.insertBefore(l, svg.firstChild);
        });
      });
    }

    function seleccionarAcorde(nombre) {
      const grupos = svg.querySelectorAll(".chord-group");
      grupos.forEach(g => {
        const txt = g.querySelector("text").textContent;
        if (txt === nombre) {
          g.classList.add("focus");
        } else {
          g.classList.remove("focus");
        }
      });
      reproducirNota(nombre);
      agregarAProgresion(nombre);
    }

    function reproducirNota(nota) {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine';
      o.frequency.value = notasFrecuencia[nota] || 440;
      o.connect(g);
      g.connect(ctx.destination);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 1);
      o.stop(ctx.currentTime + 1);
    }

    function agregarAProgresion(nota) {
      progresion.push(nota);
      document.getElementById("progresion").textContent = "Progresión: " + progresion.join(" - ");
    }

    function reproducirProgresion() {
      let delay = 0;
      progresion.forEach((nota, i) => {
        setTimeout(() => reproducirNota(nota), delay);
        delay += 1000;
      });
    }

    function limpiarProgresion() {
      progresion.length = 0;
      document.getElementById("progresion").textContent = "";
    }

    crearRed();
  </script></body>
</html>
